# Production Deployment Guide

This document provides step-by-step instructions for deploying the Funifier Gamification Dashboard to production on Vercel.

## Prerequisites Checklist

Before starting the deployment process, ensure you have:

- [ ] **Git Repository**: Code is committed and pushed to main branch
- [ ] **Vercel Account**: Account created at [vercel.com](https://vercel.com)
- [ ] **Production Credentials**: Funifier API key and production endpoints
- [ ] **Domain Ready**: Custom domain configured (if applicable)
- [ ] **Tests Passing**: All tests pass locally

## Step 1: Pre-Deployment Validation

### 1.1 Run Local Tests

```bash
# Run all tests
npm test

# Type checking
npm run type-check

# Linting
npm run lint

# Build test
npm run build
```

### 1.2 Environment Validation

```bash
# Validate environment configuration
npm run validate:env
```

If validation fails, fix the issues before proceeding.

## Step 2: Vercel Project Setup

### 2.1 Connect Repository

1. Go to [Vercel Dashboard](https://vercel.com/dashboard)
2. Click "New Project"
3. Import your Git repository
4. Select the repository containing this project
5. Vercel will auto-detect Next.js configuration

### 2.2 Configure Project Settings

**Framework Preset**: Next.js (auto-detected)
**Build Command**: `npm run build`
**Output Directory**: `.next` (auto-detected)
**Install Command**: `npm install`
**Development Command**: `npm run dev`

## Step 3: Environment Variables Configuration

### 3.1 Required Production Variables

Set these in Vercel Dashboard → Project Settings → Environment Variables:

```bash
# Funifier API Configuration
FUNIFIER_API_KEY=[your_funifier_api_key]
FUNIFIER_BASE_URL=https://service2.funifier.com/v3

# Authentication
NEXTAUTH_SECRET=your_secure_32_character_secret_here
NEXTAUTH_URL=https://your-domain.vercel.app

# Environment
NODE_ENV=production
```

### 3.2 Setting Variables via Dashboard

1. Go to Project Settings → Environment Variables
2. For each variable:
   - **Name**: Variable name (e.g., `FUNIFIER_API_KEY`)
   - **Value**: Variable value
   - **Environment**: Select "Production"
3. Click "Save"

### 3.3 Setting Variables via CLI

```bash
# Install Vercel CLI
npm i -g vercel

# Login
vercel login

# Set production variables
vercel env add FUNIFIER_API_KEY production
vercel env add FUNIFIER_BASE_URL production
vercel env add NEXTAUTH_SECRET production
vercel env add NEXTAUTH_URL production
vercel env add NODE_ENV production
```

## Step 4: Staging Deployment

### 4.1 Create Staging Branch

```bash
# Create staging branch
git checkout -b staging
git push origin staging
```

### 4.2 Configure Staging Variables

Add staging-specific environment variables:

```bash
# Staging URL (auto-generated by Vercel)
NEXTAUTH_URL=https://your-project-git-staging.vercel.app

# Use production Funifier API (or staging if available)
FUNIFIER_BASE_URL=https://service2.funifier.com/v3
```

### 4.3 Test Staging Deployment

1. Push to staging branch triggers automatic deployment
2. Vercel provides preview URL
3. Run verification script:

```bash
# Test staging deployment
node scripts/verify-production.js https://your-project-git-staging.vercel.app
```

## Step 5: Production Deployment

### 5.1 Merge to Main Branch

```bash
# Switch to main branch
git checkout main

# Merge staging changes
git merge staging

# Push to trigger production deployment
git push origin main
```

### 5.2 Monitor Deployment

1. Watch deployment progress in Vercel Dashboard
2. Check build logs for any errors
3. Verify deployment completes successfully

## Step 6: Production Verification

### 6.1 Automated Verification

```bash
# Run production verification script
node scripts/verify-production.js https://your-domain.vercel.app
```

### 6.2 Manual Verification Checklist

- [ ] **Homepage loads**: Visit main URL
- [ ] **Login page works**: Navigate to `/login`
- [ ] **API health check**: Visit `/api/health`
- [ ] **Authentication flow**: Test login with valid credentials
- [ ] **Player dashboard**: Verify dashboard loads with real data
- [ ] **Admin dashboard**: Test admin functionality
- [ ] **Report upload**: Test file upload and processing
- [ ] **Error handling**: Test with invalid inputs
- [ ] **Mobile responsiveness**: Test on mobile devices

### 6.3 Performance Verification

```bash
# Run performance tests (if available)
npm run test:performance
```

Check Vercel Analytics for:
- Page load times
- Core Web Vitals
- Error rates

## Step 7: Custom Domain Configuration (Optional)

### 7.1 Add Domain in Vercel

1. Go to Project Settings → Domains
2. Add your custom domain
3. Follow DNS configuration instructions

### 7.2 Update Environment Variables

```bash
# Update NEXTAUTH_URL with custom domain
vercel env add NEXTAUTH_URL production
# Enter: https://your-custom-domain.com
```

### 7.3 Verify Domain

1. Wait for DNS propagation (up to 24 hours)
2. Test custom domain access
3. Verify SSL certificate is active

## Step 8: Monitoring and Analytics Setup

### 8.1 Enable Vercel Analytics

1. Go to Project → Analytics
2. Enable Web Analytics
3. Configure alerts (optional)

### 8.2 Set Up Error Monitoring

The application includes built-in error boundaries and logging:

- **Error Boundaries**: Catch React errors
- **API Error Handling**: Structured error responses
- **Health Check**: `/api/health` endpoint for monitoring

### 8.3 Performance Monitoring

Monitor these metrics:
- **Page Load Time**: < 3 seconds
- **API Response Time**: < 1 second
- **Error Rate**: < 1%
- **Uptime**: > 99.9%

## Step 9: Post-Deployment Tasks

### 9.1 Immediate Verification (First 30 minutes)

- [ ] All pages load correctly
- [ ] Authentication works
- [ ] API endpoints respond
- [ ] No console errors
- [ ] Performance is acceptable

### 9.2 Extended Monitoring (First 24 hours)

- [ ] Monitor error logs
- [ ] Check performance metrics
- [ ] Verify all user flows work
- [ ] Test with real user data
- [ ] Monitor Funifier API integration

### 9.3 Documentation Updates

- [ ] Update README with production URL
- [ ] Document any deployment-specific configurations
- [ ] Update team with deployment information
- [ ] Create runbook for common issues

## Troubleshooting

### Common Issues and Solutions

#### Build Failures

**Issue**: Build fails during deployment
**Solution**:
1. Check build logs in Vercel dashboard
2. Verify all dependencies are in `package.json`
3. Test build locally: `npm run build`
4. Check for TypeScript errors: `npm run type-check`

#### Environment Variable Issues

**Issue**: Application can't connect to Funifier API
**Solution**:
1. Verify environment variables are set correctly
2. Check variable names match exactly
3. Redeploy after adding new variables
4. Test with health check endpoint

#### API Route Errors

**Issue**: API routes return 500 errors
**Solution**:
1. Check function logs in Vercel dashboard
2. Verify serverless function configuration
3. Test API routes locally
4. Check for missing dependencies

#### Authentication Issues

**Issue**: Login doesn't work in production
**Solution**:
1. Verify `NEXTAUTH_URL` matches production domain
2. Check `NEXTAUTH_SECRET` is set and secure
3. Verify Funifier API credentials
4. Test authentication flow step by step

### Emergency Rollback

If critical issues are found:

1. **Immediate**: Revert to previous deployment in Vercel dashboard
2. **Fix**: Address issues in code
3. **Redeploy**: Push fixed code to main branch
4. **Verify**: Run verification script again

### Support Contacts

- **Vercel Support**: [Vercel Help](https://vercel.com/help)
- **Funifier API**: Check Funifier documentation
- **Development Team**: [Your team contact information]

## Security Considerations

### Production Security Checklist

- [ ] **HTTPS Enforced**: All traffic uses HTTPS
- [ ] **Environment Variables**: Stored securely in Vercel
- [ ] **API Keys**: Production keys are different from development
- [ ] **Security Headers**: Configured in `next.config.js`
- [ ] **CORS**: Properly configured for API routes
- [ ] **Input Validation**: All user inputs are validated
- [ ] **Error Messages**: Don't expose sensitive information

### Ongoing Security

- [ ] **Regular Updates**: Keep dependencies updated
- [ ] **Security Monitoring**: Monitor for vulnerabilities
- [ ] **Access Control**: Limit who can deploy to production
- [ ] **Audit Logs**: Review deployment and access logs

## Performance Optimization

### Production Performance Checklist

- [ ] **Bundle Size**: Optimized and under limits
- [ ] **Image Optimization**: Using Next.js Image component
- [ ] **Caching**: Appropriate cache headers set
- [ ] **Code Splitting**: Lazy loading implemented
- [ ] **API Performance**: Response times under 1 second

### Monitoring Performance

Use Vercel Analytics to monitor:
- **Core Web Vitals**: LCP, FID, CLS
- **Page Load Times**: All pages under 3 seconds
- **API Response Times**: All endpoints under 1 second
- **Error Rates**: Keep under 1%

## Maintenance Schedule

### Daily
- [ ] Check error logs
- [ ] Monitor performance metrics
- [ ] Verify uptime

### Weekly
- [ ] Review analytics data
- [ ] Check for dependency updates
- [ ] Test critical user flows

### Monthly
- [ ] Security audit
- [ ] Performance optimization review
- [ ] Backup verification
- [ ] Documentation updates

This completes the production deployment process. The application should now be live and fully functional in the production environment.